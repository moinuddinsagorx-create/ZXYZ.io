<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ZS CLUB</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* RESET */
*{ margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Arial, sans-serif; }

/* BODY GRADIENT */
body{
    background:linear-gradient(140deg,#05001a,#0a0033,#001a66);
    background-size:400% 400%;
    animation:bgMove 12s infinite alternate ease;
    color:white; -webkit-font-smoothing:antialiased;
}
@keyframes bgMove{ 0%{background-position:0 0;} 100%{background-position:100% 100%;} }

/* LOGIN PAGE */
#loginPage{ height:100vh; display:flex; justify-content:center; align-items:center; padding:20px; }
#loginBox{
    width:95%; max-width:380px; padding:28px; border-radius:18px;
    background:rgba(255,255,255,0.06); backdrop-filter:blur(10px);
    box-shadow:0 0 35px rgba(0,150,255,0.25); animation:fadeIn .45s ease;
    border: 1px solid rgba(255,255,255,0.04);
}
#siteNameLogin{ text-align:center; font-size:30px; margin-bottom:6px; font-weight:800; color:#00eaff; letter-spacing:1px; text-shadow:0 0 18px rgba(0,234,255,0.15); }
#siteTag{ text-align:center; font-size:12px; margin-bottom:14px; color:rgba(255,255,255,0.7); }
#loginBox h2{ margin-bottom:8px; text-align:left; font-size:18px; font-weight:700; }

.input{ width:100%; padding:12px; margin-top:10px; border:none; border-radius:10px; background:rgba(255,255,255,0.08); color:white; font-size:15px; outline:none; }
.input::placeholder{ color:rgba(255,255,255,0.6); }

.loginBtn{ width:100%; padding:12px; margin-top:15px; background:#007bff; color:white; border:none; border-radius:10px; font-size:17px; cursor:pointer; transition:.18s; display:flex; justify-content:center; align-items:center; gap:10px; }
.loginBtn:hover{ background:#3395ff; box-shadow:0 0 18px #3395ff; }

@keyframes fadeIn{ from{opacity:0; transform:scale(.96);} to{opacity:1; transform:scale(1);} }

/* DASHBOARD */
#dashboard{ display:none; padding:18px; min-height:100vh; }

/* TOP BAR */
.topBar{
    background:rgba(255,255,255,0.06); padding:12px; border-radius:14px;
    box-shadow:0 0 18px rgba(0,150,255,0.18); margin-bottom:18px; display:flex; justify-content:space-between; align-items:center; gap:10px;
}
#siteBrand{ display:flex; align-items:center; gap:10px; }
#siteBrand .logoDot{ width:34px; height:34px; border-radius:8px; background:linear-gradient(135deg,#00eaff,#6a00ff); box-shadow:0 0 12px rgba(0,234,255,0.18); }
#siteBrand .brandText{ font-size:18px; font-weight:800; letter-spacing:1px; color:#00eaff; text-shadow:0 0 8px rgba(0,234,255,0.08); }

.topCenter{ text-align:center; min-width:180px; }
.topCenter b{ display:block; font-size:15px; }
.topCenter small{ display:block; font-size:12px; color:rgba(255,255,255,0.8); }

.addFundBtn{ background:#0d6efd; padding:10px 18px; border-radius:10px; border:none; color:white; cursor:pointer; font-weight:600; }
.addFundBtn:hover{ box-shadow:0 0 15px #0d6efd; transform:translateY(-2px); }

/* PRODUCT CARD */
.prodList{ margin-top:6px; display:grid; grid-template-columns:1fr; gap:12px; }
.productCard{ display:flex; gap:15px; background:rgba(255,255,255,0.04); padding:15px; border-radius:15px; box-shadow:0 0 12px rgba(0,150,255,0.06); transition:.22s; align-items:center; }
.productCard:hover{ transform:scale(1.02); box-shadow:0 0 25px rgba(0,150,255,0.18); }
.productCard img{ width:95px; height:95px; border-radius:12px; object-fit:cover; }

/* BUY BUTTON */
.buyBtn{ background:#26c281; padding:8px 18px; border-radius:10px; border:none; color:white; cursor:pointer; font-weight:700; display:flex; align-items:center; gap:8px; }
.buyBtn:disabled{ opacity:0.6; cursor:not-allowed; }

/* MODALS */
.modalBG{ position:fixed; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:none; justify-content:center; align-items:center; z-index:999; padding:20px; }
.modalBox{ width:95%; max-width:420px; background:#0d0d0f; padding:22px; border-radius:15px; text-align:center; box-shadow:0 0 35px rgba(0,120,255,0.12); animation:pop .25s ease; border:1px solid rgba(255,255,255,0.03); }
@keyframes pop{ from{transform:scale(.88); opacity:0;} to{transform:scale(1); opacity:1;} }

/* BTC ADDRESS BOX */
#btcAddress{ background:#111; padding:12px; border-radius:10px; width:100%; white-space:nowrap; overflow-x:auto; scrollbar-width:none; margin:10px 0; border:1px solid rgba(255,255,255,0.03); }
#btcAddress::-webkit-scrollbar{ display:none; }

.copyBtn{ background:#007bff; color:white; padding:10px 15px; border:none; border-radius:10px; cursor:pointer; font-weight:700; }
.copyBtn:hover{ box-shadow:0 0 15px #007bff; }

/* Minimum deposit red text */
.minDeposit{ margin-top:12px; font-weight:800; color:#ff4d4d; background:rgba(255,77,77,0.06); padding:8px 12px; border-radius:10px; display:inline-block; border:1px solid rgba(255,77,77,0.12); }

/* smaller close button style */
.closeBtn{ background:#e63946; color:white; padding:10px 16px; border:none; border-radius:10px; cursor:pointer; font-weight:700; margin-left:8px; }
.closeBtn:hover{ box-shadow:0 0 12px rgba(230,57,70,0.18); }

/* loader styles */
.globalLoader{
    position:fixed; left:0; top:0; width:100%; height:100%; display:none;
    justify-content:center; align-items:center; z-index:2000; background:rgba(0,0,0,0.55);
}
.loaderBox{
    padding:18px 26px; border-radius:12px; background:rgba(10,10,12,0.9); display:flex; gap:12px; align-items:center; box-shadow:0 8px 30px rgba(0,0,0,0.5);
    border:1px solid rgba(255,255,255,0.04);
}
.loadingSpinner{ border:3px solid rgba(255,255,255,0.2); border-top:3px solid #00eaff; border-radius:50%; width:20px; height:20px; animation:spin .9s linear infinite; }
@keyframes spin{ 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }

/* small inline spinner for button */
.inlineSpinner{ border:2px solid rgba(255,255,255,0.15); border-top:2px solid white; border-radius:50%; width:14px; height:14px; animation:spin .8s linear infinite; display:inline-block; }

/* responsiveness */
@media (max-width:480px){
    #siteNameLogin{ font-size:26px; }
    #loginBox{ padding:18px; }
    .topCenter{ min-width:120px; }
}
</style>
</head>
<body>

<!-- LOGIN PAGE -->
<div id="loginPage">
    <div id="loginBox">
        <div id="siteNameLogin">ZS CLUB</div>
        <div id="siteTag">Premium Neon Store</div>

        <h2>Login</h2>
        <p>Username & Password</p>

        <input id="username" class="input" placeholder="Username" autocomplete="username">
        <input id="password" class="input" placeholder="Password" type="password" autocomplete="current-password">

        <button class="loginBtn" id="loginBtn">
            <span id="loginBtnText">Login</span>
            <span id="loginBtnSpinner" style="display:none;"><span class="inlineSpinner"></span></span>
        </button>
    </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard">
    <div class="topBar">
        <div id="siteBrand">
            <div class="logoDot" aria-hidden="true"></div>
            <div class="brandText">ZS CLUB</div>
        </div>

        <div class="topCenter">
            <b id="showUser">Guest</b>
            <small>Balance: <span id="balance">$0.00</span></small>
        </div>

        <div style="display:flex; align-items:center;">
            <button class="addFundBtn" onclick="openFund()">Add Fund</button>
        </div>
    </div>

    <div id="prodContainer" class="prodList"></div>
</div>

<!-- ADD FUND MODAL -->
<div class="modalBG" id="fundModal" role="dialog" aria-modal="true" aria-labelledby="fundTitle">
    <div class="modalBox">
        <h3 id="fundTitle">Add Fund (BTC)</h3>
        <p>Send BTC to this address<br><b>Auto credit after network confirmation</b></p>

        <p id="btcAddress">bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh</p>

        <div class="minDeposit">Minimum deposit $20</div>

        <div style="margin-top:14px;">
            <button class="copyBtn" onclick="copyBTC()">Copy Address</button>
            <button class="closeBtn" onclick="closeFund()">Close</button>
        </div>
    </div>
</div>

<!-- BUY MODAL -->
<div class="modalBG" id="buyModal" role="dialog" aria-modal="true" aria-labelledby="buyTitle">
    <div class="modalBox">
        <h3 id="buyTitle">Insufficient Balance</h3>
        <p>Please add fund to continue</p>
        <button class="closeBtn" onclick="closeBuy()">Close</button>
    </div>
</div>

<!-- PURCHASE SUCCESS MODAL -->
<div class="modalBG" id="successModal" role="dialog" aria-modal="true">
    <div class="modalBox">
        <h3>Product purchased successfully</h3>

        <div id="successDetails" style="margin:12px 0; font-size:15px; line-height:1.6;">
            <!-- Dynamic content -->
        </div>

        <button class="closeBtn" onclick="closeSuccess()">Close</button>
    </div>
</div>

<!-- GLOBAL LOADER -->
<div class="globalLoader" id="globalLoader" role="status" aria-hidden="true">
    <div class="loaderBox">
        <div class="loadingSpinner" aria-hidden="true"></div>
        <div id="globalLoaderText">Processing, please wait...</div>
    </div>
</div>

<script>
function openFund(){ document.getElementById("fundModal").style.display="flex"; }
function closeFund(){ document.getElementById("fundModal").style.display="none"; }
function buyModalShow(){ document.getElementById("buyModal").style.display="flex"; }
function closeBuy(){ document.getElementById("buyModal").style.display="none"; }
function copyBTC(){
    let a = document.getElementById("btcAddress").innerText;
    if(navigator.clipboard && navigator.clipboard.writeText){
        navigator.clipboard.writeText(a).then(()=> alert("Address copied to clipboard!"));
    } else {
        let ta = document.createElement('textarea');
        ta.value = a;
        document.body.appendChild(ta);
        ta.select();
        try { document.execCommand('copy'); alert("Address copied to clipboard!"); }
        catch(e){ alert("Copy failed. Please select and copy manually."); }
        ta.remove();
    }
}

document.addEventListener('click', function(e){
    if(e.target.classList.contains('modalBG')){
        e.target.style.display='none';
    }
});

/* CLOSE SUCCESS POPUP */
function closeSuccess(){
    document.getElementById("successModal").style.display = "none";
}

/* SUCCESS POPUP SHOW FUNCTION */
function showSuccess(productName){
    const orderId = "AB" + Math.floor(100000 + Math.random()*900000);
    document.getElementById("successDetails").innerHTML = `
        <b>Product:</b> ${productName}<br>
        <b>Order ID:</b> #${orderId}<br>
        <b>Status:</b> Completed
    `;
    document.getElementById("successModal").style.display = "flex";
}
</script>

<script>
/* Demo products */
let products = [];
for(let i=1;i<=12;i++){
    products.push({
        id: 'prod-'+i,
        title:"Premium Neon Light",
        price:5 + (i%4)*3,
        img:"https://i.postimg.cc/Gm5ZRq3S/image-search-1764267137285.png"
    });
}
let featureText = `
• High quality neon design<br>
• Instant download (digital)<br>
• 30 minutes support guarantee<br>
• Suitable for personal use
`;

function renderProducts(){
    let html="";
    products.forEach(p=>{
        html+=`
        <div class='productCard' id='card-${p.id}'>
            <img src='${p.img}' alt='${p.title}'>
            <div style='width:100%'>
                <div style='font-size:18px; font-weight:700'>${p.title}</div>
                <div style='font-size:13px; margin:8px 0; color:rgba(255,255,255,0.85)'>${featureText}</div>

                <div style='display:flex; justify-content:space-between; align-items:center; gap:12px;'>
                    <span style='font-weight:800'>$${p.price.toFixed(2)}</span>
                    <button class='buyBtn' data-price='${p.price}' data-title='${p.title}'>
                        <span class="buyBtnText">Buy</span>
                        <span class="buyBtnSpinner" style="display:none;"><span class="inlineSpinner"></span></span>
                    </button>
                </div>
            </div>
        </div>
        `;
    });
    document.getElementById("prodContainer").innerHTML = html;

    document.querySelectorAll(".buyBtn").forEach(btn=>{
        btn.addEventListener('click', () => {
            const price = Number(btn.dataset.price);
            const pName = btn.dataset.title;
            buyProduct(price, btn, pName);
        });
    });
}
renderProducts();
</script>

<!-- FIREBASE + AUTH -->
<script type="module">
const firebaseConfig = {
  apiKey: "AIzaSyC4y-hWBBKaZ9yKk1MqJndd7VpCcKhipyo",
  authDomain: "xyz-6e6e7.firebaseapp.com",
  projectId: "xyz-6e6e7",
  storageBucket: "xyz-6e6e7.firebasestorage.app",
  messagingSenderId: "711710123222",
  appId: "1:711710123222:web:dfdcca06adb98c37425577",
  measurementId: "G-8D8JSWFVX4"
};

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-analytics.js";
import {
  getFirestore, doc, getDoc, setDoc, onSnapshot, runTransaction
} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

const app = initializeApp(firebaseConfig);
try { getAnalytics(app); } catch(e){ }
const db = getFirestore(app);

const loginBtn = document.getElementById('loginBtn');
const usernameInput = document.getElementById('username');
const passwordInput = document.getElementById('password');
const loginPage = document.getElementById('loginPage');
const dashboard = document.getElementById('dashboard');
const showUser = document.getElementById('showUser');
const balanceEl = document.getElementById('balance');
const globalLoader = document.getElementById('globalLoader');
const globalLoaderText = document.getElementById('globalLoaderText');

let currentUser = null;
let unsubscribeBalance = null;

function showGlobalLoader(text){
    globalLoader.style.display = 'flex';
    if(text) globalLoaderText.innerText = text;
}
function hideGlobalLoader(){
    globalLoader.style.display = 'none';
}

function normalizeUsername(u){ return String(u || '').trim().toLowerCase(); }

function showError(msg, e){
    console.error(msg, e || '');
    alert(msg);
}

loginBtn.addEventListener('click', async function(){
    const username = normalizeUsername(usernameInput.value);
    const password = String(passwordInput.value || '').trim();

    if(!username || !password){
        alert('Enter username & password');
        return;
    }

    const loginBtnText = document.getElementById('loginBtnText');
    const loginBtnSpinner = document.getElementById('loginBtnSpinner');
    loginBtnText.style.display = 'none';
    loginBtnSpinner.style.display = 'inline-block';
    showGlobalLoader('Logging in...');

    const userRef = doc(db, 'users', username);

    try {
        const snap = await getDoc(userRef);
        if(snap.exists()){
            const data = snap.data();
            if(data.password === password){
                afterLogin(username);
            } else {
                alert('Incorrect password');
            }
        } else {
            await setDoc(userRef, { password, balance: 0 });
            afterLogin(username);
        }
    } catch(err){
        showError('Login/Register failed. Check console.', err);
    } finally {
        loginBtnText.style.display = 'inline';
        loginBtnSpinner.style.display = 'none';
        hideGlobalLoader();
    }
});

function afterLogin(username){
    currentUser = username;
    showUser.innerText = username;
    loginPage.style.display = 'none';
    dashboard.style.display = 'block';

    if(typeof unsubscribeBalance === 'function') unsubscribeBalance();

    const userRef = doc(db, 'users', currentUser);
    unsubscribeBalance = onSnapshot(userRef, (snap) => {
        if(snap.exists()){
            const bal = Number(snap.data().balance || 0);
            balanceEl.innerText = '$' + bal.toFixed(2);
        }
    });
}

async function buyProduct(price, btnElement, productName){
    if(!currentUser){
        alert('Please login first.');
        return;
    }

    const userRef = doc(db, 'users', currentUser);

    const btnText = btnElement.querySelector('.buyBtnText');
    const btnSpinner = btnElement.querySelector('.buyBtnSpinner');
    btnElement.disabled = true;
    btnText.style.display = 'none';
    btnSpinner.style.display = 'inline-block';
    showGlobalLoader('Processing purchase...');

    try {
        await runTransaction(db, async (transaction) => {
            const snap = await transaction.get(userRef);
            const balance = Number(snap.data().balance || 0);
            if(balance >= price){
                transaction.update(userRef, { balance: balance - price });
            } else {
                throw { code: 'INSUFFICIENT' };
            }
        });

        showSuccess(productName);

    } catch(err){
        if(err.code === 'INSUFFICIENT'){
            buyModalShow();
        } else {
            alert('Transaction failed.');
        }
    } finally {
        btnElement.disabled = false;
        btnText.style.display = 'inline';
        btnSpinner.style.display = 'none';
        hideGlobalLoader();
    }
}

window.buyProduct = buyProduct;
</script>

</body>
</html>